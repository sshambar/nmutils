#!/bin/bash
#
# nsupdate-mock for test scripts
#

err() {
  local IFS; unset IFS
  printf >&2 "%s\n" "$*"
}

fail() {
  local -i rc=1
  printf 2>/dev/null -v rc "%d" "$1"
  [[ $rc == 0 ]] && rc=1
  shift
  [[ $1 ]] && err "$@"
  exit "$rc"
}

[[ ${NSUPDATE_MOCK_FAIL-} ]] &&
  fail "${NSUPDATE_MOCK_FAIL}" "${NSUPDATE_MOCK_OUTPUT-}"

[[ ${NSUPDATE_MOCK_OUTPUT-} ]] && { echo "${NSUPDATE_MOCK_OUTPUT}"; exit 0; }

# echo commands if requested
if [[ ${MOCK_ECHO} ]]; then
  echo "nsupdate" "$@"
  command -p cat -
fi

exit 0
